<!DOCTYPE html>
<head>
</head>
<body>
    <p>Page de connexion</p>
    <div id="login">
        <label for="username">Nom d'utilisateur : </label>
        <input type="text" id="username" rows="1" cols="30"></textarea>
        <input type="submit" id="loginButton" onclick="connect()" value="Se connecter"></input>
    </div>
    <div id="zone_info">
        <p id="connected"></p>
    </div>
    <script>
        // Affichage d'informatin
        let info = document.getElementById("connected");

        /**
         * Envoie au serveur les données pour se connecter
         */
        async function connect() {
            let user = document.getElementById("username");
            let loginButton = document.getElementById("loginButton");

            // Cas où aucun nom n'est renseigné
            if (user.value === "") {
                info.innerText = "Veuillez renseigner un nom.";
                return;
            }

            let post = {
                name: user.value
            };
            let res = await fetch("/login", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"

                },
                body: JSON.stringify(post)
            })
            let response = JSON.parse(await res.json());
            console.log(response);
            if (response.status === "OK") {
                info.innerText = "En attente des autres joueurs...";
                user.disabled = true;
                loginButton.disabled = true;
                start();
            } else {
                info.innerText = response.message;
                user.value = "";
            }
        }

        /**
         * Redirige les joueurs vers la page du jeu une fois que tous les joueurs sont connectés
         */
        async function start() {
            let res = await fetch("/start");
            let response = JSON.parse(await res.json());
            if (response.joueursComplet) {
                info.innerText = "Prêt à démarrer !"
                setTimeout(() => {
                    location.href = "/game";
                }, 1000);
            } else {
                setTimeout(() => {
                    start();
                }, 1000);
            }
        }
    </script>
</body>